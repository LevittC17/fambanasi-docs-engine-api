============================= test session starts ==============================
platform linux -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0 -- /home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/bin/python
cachedir: .pytest_cache
rootdir: /home/whiterabbit/WhiteRabbit/Fambanasi/docs/fambanasi-docs-engine-api
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.12.1, cov-7.0.0, mock-3.15.1, asyncio-1.3.0, Faker-40.4.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 60 items

tests/integration/test_documents_api.py::TestGetDocument::test_get_document_success PASSED [  1%]
tests/integration/test_documents_api.py::TestGetDocument::test_get_document_with_branch PASSED [  3%]
tests/integration/test_documents_api.py::TestCreateDocument::test_create_document_requires_auth FAILED [  5%]
tests/integration/test_documents_api.py::TestCreateDocument::test_create_document_requires_editor PASSED [  6%]
tests/integration/test_documents_api.py::TestCreateDocument::test_create_document_success PASSED [  8%]
tests/integration/test_documents_api.py::TestCreateDocument::test_create_document_invalid_path PASSED [ 10%]
tests/integration/test_documents_api.py::TestCreateDocument::test_create_document_missing_content PASSED [ 11%]
tests/integration/test_documents_api.py::TestDeleteDocument::test_delete_requires_editor PASSED [ 13%]
tests/integration/test_drafts_api.py::TestCreateDraft::test_create_draft_requires_auth FAILED [ 15%]
tests/integration/test_drafts_api.py::TestCreateDraft::test_create_draft_success PASSED [ 16%]
tests/integration/test_drafts_api.py::TestCreateDraft::test_create_draft_invalid_target_path PASSED [ 18%]
tests/integration/test_drafts_api.py::TestDraftWorkflow::test_full_draft_workflow 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! KeyboardInterrupt !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
/usr/lib/python3.14/asyncio/runners.py:132: KeyboardInterrupt
(to show a full traceback on KeyboardInterrupt use --full-trace)
Traceback (most recent call last):
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 307, in rollback
    self.await_(self._connection.rollback())
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/aiosqlite/core.py", line 197, in rollback
    await self._execute(self._conn.rollback)
                        ^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/aiosqlite/core.py", line 137, in _conn
    raise ValueError("no active connection")
ValueError: no active connection

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py", line 1128, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/default.py", line 712, in do_rollback
    dbapi_connection.rollback()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 309, in rollback
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 338, in _handle_exception
    raise self.dbapi.sqlite.OperationalError(
        "no active connection"
    ) from error
sqlite3.OperationalError: no active connection

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/bin/pytest", line 8, in <module>
    sys.exit(console_main())
             ~~~~~~~~~~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/config/__init__.py", line 223, in console_main
    code = main()
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/config/__init__.py", line 199, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_callers.py", line 167, in _multicall
    raise exception
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/main.py", line 365, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/main.py", line 353, in wrap_session
    config.hook.pytest_sessionfinish(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session=session, exitstatus=session.exitstatus
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_callers.py", line 167, in _multicall
    raise exception
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/logging.py", line 873, in pytest_sessionfinish
    return (yield)
            ^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/terminal.py", line 960, in pytest_sessionfinish
    result = yield
             ^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/warnings.py", line 118, in pytest_sessionfinish
    return (yield)
            ^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/runner.py", line 112, in pytest_sessionfinish
    session._setupstate.teardown_exact(None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/runner.py", line 566, in teardown_exact
    raise exceptions[0]
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/runner.py", line 555, in teardown_exact
    fin()
    ~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/fixtures.py", line 1053, in finish
    raise exceptions[0]
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/_pytest/fixtures.py", line 1042, in finish
    fin()
    ~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py", line 330, in finalizer
    runner.run(async_finalizer(), context=context)
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.14/asyncio/base_events.py", line 719, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py", line 322, in async_finalizer
    await gen_obj.__anext__()
  File "/home/whiterabbit/WhiteRabbit/Fambanasi/docs/fambanasi-docs-engine-api/tests/conftest.py", line 75, in db_session
    await session.rollback()
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/ext/asyncio/session.py", line 990, in rollback
    await greenlet_spawn(self.sync_session.rollback)
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py", line 1992, in rollback
    self._transaction.rollback(_to_root=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in rollback
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py", line 1393, in rollback
    raise rollback_err[1].with_traceback(rollback_err[2])
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py", line 1358, in rollback
    t[1].rollback()
    ~~~~~~~~~~~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py", line 2619, in rollback
    self._do_rollback()
    ~~~~~~~~~~~~~~~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py", line 2738, in _do_rollback
    self._close_impl(try_deactivate=True)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py", line 2721, in _close_impl
    self._connection_rollback_impl()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py", line 2713, in _connection_rollback_impl
    self.connection._rollback_impl()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py", line 1130, in _rollback_impl
    self._handle_dbapi_exception(e, None, None, None, None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py", line 1128, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/engine/default.py", line 712, in do_rollback
    dbapi_connection.rollback()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 309, in rollback
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/whiterabbit/.cache/pypoetry/virtualenvs/fambanasi-docs-engine-api--E-SZKBC-py3.14/lib/python3.14/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 338, in _handle_exception
    raise self.dbapi.sqlite.OperationalError(
        "no active connection"
    ) from error
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no active connection
(Background on this error at: https://sqlalche.me/e/20/e3q8)
